# Expected output:
# > $CRONTAB
# >
test-cron:
  build: .
  entrypoint: bash -x /entrypoint.sh
  command: 'crontab -u root -l'
  environment:
    CRON_OWNER: root
    CRON_ENV_FILE: /var/env.cron
    CRON_TAB: |
      * *    * * *    . /var/env.cron; env; touch /.cron; echo Cron fired at $$(date)
    TZ: Pacific/Auckland

# Expected output:
# > no crontab for root
# Or a blank line
# >
test-no-cron:
  build: .
  entrypoint: bash -x /entrypoint.sh
  command: 'crontab -l'



test-env:
  build: .
  entrypoint: bash -x /entrypoint.sh
  command: crontab -l
  environment:
    TEST: all vars are stored!
    CRON_ENV_FILE: /var/cron.env
    CRON_TAB: |
      # even multi-line ones!
      * *    * * *    . /var/cron.env; printenv
    QUOTES: it's bound to go wrong with an extra quote
    DQUOTES: I said, "it's bound to go wrong with an extra quote"

cron:
  build: .
  environment:
    CRON_ENV_FILE: /var/cron.env
    CRON_TAB: |
      * *    * * *    cat /var/cron.env; echo =======; printenv; echo =======; . /var/cron.env; printenv
    TZ: Pacific/Auckland
  volumes:
    - /var/mail

mail:
  image: debian:stable
  command: bash -c 'while ! tail -F /var/mail/*; do sleep 1; done'
  volumes_from:
    - cron
